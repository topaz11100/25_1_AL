### 보조공식 : 단일 원소 추가·제거 시 집합의 분산의 변화

집합 $A=\{x_1,\dots,x_m\}$ ($m\ge1$) 의 평균과 분산은 아래와 같다
$$
\mu_A=\frac1m\sum_{i=1}^m x_i, \qquad
V_A=\frac1m\sum_{i=1}^m (x_i-\mu_A)^2
$$

### (1) 원소 $x$를 추가한 집합 $A^+=A\cup\{x\}$ 의 분산

$A^+$ 의 크기는 $m+1$
$$
\mu_{A^+}
=\frac1{m+1}\Bigl(\sum_{i=1}^m x_i + x\Bigr)
=\frac{m\mu_A + x}{m+1}
\tag{1}
$$
분산 정의에 따라
$$
(m+1)V_{A^+}
  =\sum_{i=1}^m(x_i-\mu_{A^+})^2 + (x-\mu_{A^+})^2
  =\sum_{i=1}^m\!\Bigl[(x_i-\mu_A)+(\mu_A-\mu_{A^+})\Bigr]^2
   + (x-\mu_{A^+})^2 
$$

식 (1) 에 의해 $(\mu_A-\mu_{A^+})=\dfrac{x-\mu_A}{m+1}$ 이므로 시그마 밖으로 뺄 수 있다

$$
(m+1)V_{A^+}
  =\sum_{i=1}^m(x_i-\mu_A)^2
   +\frac{m(x-\mu_A)^2}{(m+1)^2}
   + (x-\mu_{A^+})^2
$$

$(x-\mu_{A^+})=(x-\mu_A)-(\mu_{A^+}-\mu_A)=\dfrac{m}{m+1}(x-\mu_A)$ 이다 따라서

$$
(m+1)V_{A^+}
  = m V_A
  + \frac{m(x-\mu_A)^2}{(m+1)^2}
  + \frac{m^2(x-\mu_A)^2}{(m+1)^2}
  = m V_A + \frac{m(x-\mu_A)^2}{m+1}
$$

양변을 $(m+1)$ 로 나누면

$$
V_{A^+} = \frac{m}{m+1}V_A + \frac{(x-\mu_A)^2}{m+1}
$$

변화량은 아래와 같다
$$
\Delta_{+} = V_{A^+} - V_{A} = \frac{(x-\mu_A)^2-V_{A}}{m+1}
$$

### (2) 원소 $x$를 제거한 집합 $A^-=A\setminus\{x\}$ 의 분산 ($m\ge2$)

$A$ 의 한 원소가 $x$ 라고 하고 $A^-=\{x_1,\dots,x_{m-1}\}$
$$
\mu_{A^-}=\frac1{m-1}\Bigl(\sum_{i=1}^{m-1}x_i\Bigr)
         =\frac{m\mu_A - x}{m-1}
       =\mu_A + \frac{\mu_A-x}{m-1}
$$
분산 계산:
$$
(m-1)V_{A^-}
  =\sum_{i=1}^{m-1}(x_i-\mu_{A^-})^2
  =\sum_{i=1}^{m-1}\!\Bigl[(x_i-\mu_A)+(\mu_A-\mu_{A^-})\Bigr]^2
$$
이때 $(\mu_A-\mu_{A^-})=\dfrac{x-\mu_A}{m-1}$
전개하면
$$
(m-1)V_{A^-}
  =\sum_{i=1}^{m-1}(x_i-\mu_A)^2
   +\frac{(m-1)(x-\mu_A)^2}{(m-1)^2}
   -\frac{2(x-\mu_A)}{m-1}\sum_{i=1}^{m-1}(x_i-\mu_A)
$$
마지막 합은 $-(x-\mu_A)(m\mu_A - x - (m-1)\mu_A)=0$
또 $\sum_{i=1}^{m-1}(x_i-\mu_A)^2 = mV_A - (x-\mu_A)^2$
따라서
$$
(m-1)V_{A^-}
  = mV_A - (x-\mu_A)^2 + \frac{(x-\mu_A)^2}{m-1}
  = mV_A - \frac{m(x-\mu_A)^2}{m-1}
$$

나누면

$$
V_{A^-} = \frac{m}{m-1}V_A - \frac{(x-\mu_A)^2}{m-1}
$$

변화량은 다음과 같다

$$
\Delta_{-} = V_{A^-} - V_{A} = \frac{V_{A}-(x-\mu_A)^2}{m-1}
$$




====================================================================
최소 분산 분할 ⇒ 연속구간   ―  “세 점 a_i,a_j,a_k 성질”만으로 증명
====================================================================

배경 그림 (첨부 이미지)
----------------------
비연속(non‑contiguous) 분할에서는 세 점
$a_i < a_j < a_k$ 중
$a_i,a_k$는 한 부분집합 $G$,
$a_j$는 다른 부분집합 $H$에 들어 있다.  
각 집합 평균을 $\mu_G,\mu_H$라 하자.

이미지에서 얻는 **핵심 사실**  
(세 점 거리 중 하나가 ‘다른 집합 평균’에 더 가깝다)

> $$\text{적어도 한 점 } a^\star \in\{a_i,a_j,a_k\} \text{ 에 대해 }  
> |a^\star-\mu_{\text{own}}| \;\ge\; |a^\star-\mu_{\text{other}}|>0.$$

아래에서 이 $a^\star$를 *틈새 원소*라 부른다.

목표
----
분산합(=SSE/데이터수) 최소 분할 $P^\ast$에  
비연속 그룹이 있을 수 없음을 **분산(SSE) 변화**만으로 보인다.

--------------------------------------------------------------------
1. SSE(sum of squared errors)와 분산
--------------------------------------------------------------------
집합 $A$ 크기를 $|A|=m$, 분산을 $V_A$라 할 때  
SSE는 $$\operatorname{SSE}(A)=m\,V_A.$$

원소 $x$를 제거·추가할 때 SSE 변화는 **아주 단순**하다.

- 제거($m\ge2$):
  $$\operatorname{SSE}(A\setminus\{x\})
      = mV_A-(x-\mu_A)^2.$$

- 추가($m\ge1$):
  $$\operatorname{SSE}(A\cup\{x\})
      = mV_A+(x-\mu_A)^2.$$

(유도: 교과서 분산 갱신식에 $mV_A= \sum(y-\mu_A)^2$ 만 대입하면 된다.)

--------------------------------------------------------------------
2. 틈새 원소를 다른 집합으로 옮겼을 때 SSE 변화
--------------------------------------------------------------------
$G$ 크기 $m(\ge2)$, $H$ 크기 $n(\ge1)$, 틈새 원소 $a^\star$가
현재 집합을 떠나 **다른 집합으로 이동**한다고 하자.

- $G$에서 $a^\star$ 제거:  
  $$\Delta_{\text{out}} = -\bigl(a^\star-\mu_G\bigr)^2.$$

- $H$에 $a^\star$ 추가:  
  $$\Delta_{\text{in}}  =  \bigl(a^\star-\mu_H\bigr)^2.$$

총 변화
$$
\Delta_{\text{total}}
   = \Delta_{\text{out}}+\Delta_{\text{in}}
   = \bigl(a^\star-\mu_H\bigr)^2
     -\bigl(a^\star-\mu_G\bigr)^2.
$$

--------------------------------------------------------------------
3. 틈새 원소의 ‘더 가까운 평균’ 성질 → 분산 감소
--------------------------------------------------------------------
이미지 조건에 의해
$$
|a^\star-\mu_G|\;\ge\;|a^\star-\mu_H|>0
\;\Longrightarrow\;
\bigl(a^\star-\mu_G\bigr)^2
  >  \bigl(a^\star-\mu_H\bigr)^2.
$$

따라서
$$
\Delta_{\text{total}}
   =\bigl(a^\star-\mu_H\bigr)^2
    -\bigl(a^\star-\mu_G\bigr)^2
   <0.
$$

즉 **틈새 원소를 옮기면 SSE(=분산합) 이 엄밀히 감소**한다.

--------------------------------------------------------------------
4. 단일 원소 집합 $H$ 도 안전
--------------------------------------------------------------------
$n=1$이면 $H$ 분산은 항상 $0$ 이라
위 식이 그대로 통하며, $n$ 값과 무관하게
$\Delta_{\text{total}}<0$ 임이 유지된다  
(추가 후 $H$ 분산이 생기더라도 차이는 여전히 위 부등식).

--------------------------------------------------------------------
5. 귀류 완료
--------------------------------------------------------------------
비연속 그룹이 있으면 틈새 원소 이동만으로
$$
\operatorname{SSE}_{\text{new}}
      =\operatorname{SSE}_{P^\ast}+\Delta_{\text{total}}
      <\operatorname{SSE}_{P^\ast},
$$
$P^\ast$가 “최소”라는 가정과 모순.  

따라서 **최소 분산(또는 SSE) 분할은 반드시 모든 그룹이 S에서 연속 구간**이어야 한다. ∎
